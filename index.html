<!-- Updated HTML with editable borrow date for admin -->
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T·ªß s√°ch TD4</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; margin: 0; background: #f3f4e7; }
header { background: #556b2f; color: white; padding: 15px; text-align: center; font-size: 22px; }
.container { padding: 15px; }
.search-box input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #777; }
.filters { display:flex; gap:10px; margin-top:10px; }
.filters select { flex:1; padding:10px; border-radius:6px; border:1px solid #777; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
th { background: #556b2f; color: white; padding: 10px; font-size: 14px; }
td { padding: 10px; border-bottom: 1px solid #ddd; }
tr:hover { background: #eef2d5; }
.stats { background:#fff; padding:12px; border-radius:8px; margin-top:15px; border-left:5px solid #556b2f; }
.pagination { text-align:center; margin: 15px 0; }
.pagination button { padding: 8px 14px; margin: 2px; border:none; border-radius:5px; background:#556b2f; color:white; }
.tabs { display:flex; background:#556b2f; }
.tabs button { flex:1; padding:12px; background:#556b2f; color:white; border:none; font-size:16px; }
.tabs button.active { background:#445522; font-weight:bold; }
.section { display:none; }
.section.active { display:block; }
.input-row { margin:10px 0; }
.input-row input, .input-row select { width:100%; padding:10px; border:1px solid #777; border-radius:6px; }
.action-btn { background:#556b2f; color:white; padding:10px; border:none; width:100%; margin-top:10px; border-radius:6px; }
.editable-date { width: 140px; }
</style>
</head>
<body>
<header style="display:flex;align-items:center;gap:20px;justify-content:center;">
  <img src="https://raw.githubusercontent.com/ducquy98tp-sudo/tusach-td4/main/logo_cropped_round.png" style="height:50px;object-fit:contain;">
  <span style="font-size:22px;"> T·ªß S√°ch Ti·ªÉu ƒêo√†n 4</span>
  <img src="https://raw.githubusercontent.com/ducquy98tp-sudo/tusach-td4/main/pngtree-book-pencil-study-book-png-image_4507678.jpg" style="height:50px;object-fit:contain;">
</header>
<div style="padding:10px; background:#f3f4e7; text-align:center;">
  <input id="adminPass" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u qu·∫£n l√Ω..." style="padding:10px;width:70%;border-radius:6px;border:1px solid #666;">
  <button onclick="checkAdmin()" style="padding:10px 15px;margin-left:5px;background:#556b2f;color:white;border:none;border-radius:6px;">üîê ƒêƒÉng nh·∫≠p</button>
</div>
<div class="tabs" id="mainTabs" style="display:none;">
  <button class="active" onclick="openTab('books')">Danh m·ª•c s√°ch</button>
  <button onclick="openTab('borrow')">M∆∞·ª£n - Tr·∫£</button>
</div>

<div class="container">

<!-- DANH M·ª§C S√ÅCH -->
<div id="books" class="section active">
  <div class="search-box"><input id="searchInput" placeholder="üîé T√¨m ki·∫øm s√°ch..." onkeyup="searchBooks()"></div>
  <div class="filters">
    <select id="authorFilter" onchange="applyFilters()"><option value="">L·ªçc theo t√°c gi·∫£</option></select>
    <select id="yearFilter" onchange="applyFilters()"><option value="">L·ªçc theo nƒÉm</option></select>
  </div>
  <div class="stats" id="statsBox">T·ªïng s·ªë s√°ch: 0 ‚Ä¢ ƒêang m∆∞·ª£n: 0</div>
  <table>
    <thead><tr><th>M√£</th><th>S√°ch</th><th>T√°c gi·∫£</th></tr></thead>
    <tbody id="bookTable"></tbody>
  </table>
  <div class="pagination" id="pagination"></div>
</div>

<!-- M∆Ø·ª¢N TR·∫¢ -->
<div id="borrow" class="section">
  <h3>M∆∞·ª£n s√°ch</h3>
  <div class="input-row"><select id="borrowBook"></select></div>
  <div class="input-row"><input id="borrower" placeholder="Ng∆∞·ªùi m∆∞·ª£n"></div>
  <div class="input-row"><input id="unit" placeholder="ƒê∆°n v·ªã"></div>
  <div class="input-row"><input id="note" placeholder="Ghi ch√∫"></div>
  <button class="action-btn" onclick="borrowBookAction()">üìò M∆∞·ª£n s√°ch</button>

  <h3 style="margin-top:25px;">Danh s√°ch ƒëang m∆∞·ª£n</h3>
  <table>
    <thead><tr><th>S√°ch</th><th>Ng∆∞·ªùi m∆∞·ª£n</th><th>ƒê∆°n v·ªã</th><th>Ng√†y</th><th></th></tr></thead>
    <tbody id="borrowTable"></tbody>
  </table>
</div>

</div>

<script>
let adminMode = false;
const ADMIN_PASSWORD = "ngducquy";
function checkAdmin(){
  if(document.getElementById('adminPass').value === ADMIN_PASSWORD){
    adminMode = true;
    document.getElementById('mainTabs').style.display = 'flex';
    alert('ƒêƒÉng nh·∫≠p qu·∫£n l√Ω th√†nh c√¥ng!');
    renderBorrowTable();
  } else alert('Sai m·∫≠t kh·∫©u!');
}

let books = [];
let borrowList = [];
let currentPage = 1;
const itemsPerPage = 20;

fetch('books.json')
  .then(res => res.json())
  .then(data => { books = data; loadBooks(); loadBorrowDropdown(); });

function loadBooks(){
  let table = document.getElementById('bookTable');
  table.innerHTML = '';
  let start = (currentPage - 1) * itemsPerPage;
  let end = start + itemsPerPage;
  books.slice(start, end).forEach(b => {
    table.innerHTML += `<tr><td>${b.code}</td><td>${b.title}</td><td>${b.author}</td></tr>`;
  });
  loadPagination();
}
function loadPagination(){
  let pag = document.getElementById('pagination');
  pag.innerHTML='';
  let totalPages = Math.ceil(books.length / itemsPerPage);
  for(let i=1;i<=totalPages;i++) pag.innerHTML += `<button onclick="gotoPage(${i})">${i}</button>`;
}
function gotoPage(p){ currentPage=p; loadBooks(); }

function searchBooks(){
  let txt = document.getElementById('searchInput').value.toLowerCase();
  books = books.filter(b => b.title.toLowerCase().includes(txt));
  currentPage=1; loadBooks();
}

function openTab(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

function loadBorrowDropdown(){
  let dropdown = document.getElementById('borrowBook');
  dropdown.innerHTML = books.map((b,i)=>`<option value="${i}">${b.title}</option>`).join('');
}

function borrowBookAction(){
  let idx = document.getElementById('borrowBook').value;
  let borrower = document.getElementById('borrower').value.trim();
  if(!borrower) return alert('Nh·∫≠p t√™n ng∆∞·ªùi m∆∞·ª£n');

  borrowList.push({
    title: books[idx].title,
    borrower,
    unit: document.getElementById('unit').value,
    note: document.getElementById('note').value,
    date: new Date().toISOString().split('T')[0]
  });

  renderBorrowTable();
}

function renderBorrowTable(){
  let tb = document.getElementById('borrowTable');
  tb.innerHTML = '';

  borrowList.forEach((b,i)=>{
    let dateCell = adminMode
      ? `<input type='date' class='editable-date' value='${b.date}' onchange='updateDate(${i}, this.value)'>`
      : b.date;

    tb.innerHTML += `<tr>
      <td>${b.title}</td>
      <td>${b.borrower}</td>
      <td>${b.unit}</td>
      <td>${dateCell}</td>
      <td><button onclick='removeBorrow(${i})'>‚ùå</button></td>
    </tr>`;
  });
}

function updateDate(i, newDate){
  borrowList[i].date = newDate;
}

function removeBorrow(i){
  borrowList.splice(i,1);
  renderBorrowTable();
}
</script>
</body>
</html>
